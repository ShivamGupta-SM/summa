---
title: HTTP API
description: Expose Summa as a REST API with Hono, Express, Fastify, Next.js, or any Fetch-compatible runtime.
icon: Server
---

## Overview

Summa provides a framework-agnostic HTTP API handler that can be mounted on **Hono**, **Express**, **Fastify**, **Next.js**, or any runtime supporting the **Web Fetch API** (Deno, Bun, Cloudflare Workers). The API exposes all core operations: accounts, transactions, holds, limits, and events.

## Framework Integrations

See the dedicated framework guides for setup, authentication, rate limiting, and production examples:

- [Hono](/docs/frameworks/hono) — `createSummaHono()`
- [Express](/docs/frameworks/express) — `createSummaExpress()`
- [Fastify](/docs/frameworks/fastify) — `createSummaFastify()`
- [Next.js](/docs/frameworks/next) — `createSummaNextHandler()`
- [Elysia](/docs/frameworks/elysia) — `createSummaElysia()`
- [Encore](/docs/frameworks/encore) — `createSummaEncore()`
- [Fetch API](/docs/frameworks/fetch) — `createSummaFetchHandler()` (Deno, Bun, Cloudflare Workers)

## Handler Options

All framework integrations accept the same options:

```ts
interface ApiHandlerOptions {
  rateLimiter?: RateLimiter;
  rateLimitKeyExtractor?: (req: ApiRequest) => string;
  trustedOrigins?: string[];
  onRequest?: (req: ApiRequest) => ApiRequest | ApiResponse | Promise<ApiRequest | ApiResponse>;
  onResponse?: (req: ApiRequest, res: ApiResponse) => ApiResponse | Promise<ApiResponse>;
}
```

| Option | Type | Description |
|--------|------|-------------|
| `rateLimiter` | `RateLimiter` | Rate limiter instance (see [Rate Limiting](#rate-limiting)) |
| `rateLimitKeyExtractor` | `function` | Extract rate limit key from request (e.g., API key, IP). Default: `"global"` |
| `trustedOrigins` | `string[]` | CSRF protection — only allow mutating requests from these origins |
| `onRequest` | `function` | Request interceptor. Return an `ApiResponse` to short-circuit (e.g., 401 for auth). |
| `onResponse` | `function` | Response interceptor. Modify responses before they are sent. |

### Request/Response Hooks

Use `onRequest` to add authentication, logging, or early rejection:

```ts
const handler = createSummaHono(summa, {
  onRequest: (req) => {
    const apiKey = req.headers?.["x-api-key"];
    if (!apiKey || !isValidApiKey(apiKey)) {
      return { status: 401, body: { error: { code: "UNAUTHORIZED", message: "Invalid API key" } } };
    }
    return req; // Continue to route handler
  },
  onResponse: (req, res) => {
    console.log(`${req.method} ${req.path} → ${res.status}`);
    return res;
  },
});
```

**Execution order:** `onRequest` → CSRF check → rate limiting → plugin `onRequest` hooks → route handler → plugin `onResponse` hooks (reverse order) → `onResponse`

### Request ID

Every response includes an `X-Request-Id` header. The handler extracts it from the incoming `x-request-id` header (for distributed tracing) or generates a UUID if not present. Use this for correlating logs and traces across services.

### Actor Identity

Pass the `x-actor-id` header to associate the requesting user/service with the operation. This is used by the audit log plugin and is available to all operation hooks via `RequestContext`:

```bash
curl -X POST http://localhost:3000/api/ledger/transactions/credit \
  -H "Content-Type: application/json" \
  -H "x-actor-id: admin@example.com" \
  -d '{ "holderId": "user_123", "amount": 10000, "reference": "dep-001" }'
```

The actor is stored in audit log entries and can be queried for compliance reporting. See [Audit Log — Actor Tracking](/docs/plugins/audit-log#actor-tracking).

## API Endpoints

### Health

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/ok` | Liveness probe — returns `{ ok: true }` |
| `GET` | `/health` | Readiness probe — deep health check with DB connectivity and schema verification |

The `/health` endpoint returns `200` when healthy or `503` when degraded:

```json
{
  "status": "healthy",
  "checks": {
    "database": { "status": "ok" },
    "schema": { "status": "ok", "workerLeases": 3 }
  },
  "timestamp": "2026-02-21T10:30:00.000Z"
}
```

### Accounts

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/accounts` | List accounts with pagination and filtering |
| `POST` | `/accounts` | Create a new account |
| `GET` | `/accounts/:holderId` | Get account by holder ID |
| `GET` | `/accounts/:holderId/balance` | Get account balance |
| `POST` | `/accounts/:holderId/freeze` | Freeze an account |
| `POST` | `/accounts/:holderId/unfreeze` | Unfreeze an account |
| `POST` | `/accounts/:holderId/close` | Close an account (with optional fund sweep) |

**List accounts query parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `page` | `number` | Page number (1-based) |
| `perPage` | `number` | Items per page |
| `status` | `string` | Filter: `"active"` \| `"frozen"` \| `"closed"` |
| `holderType` | `string` | Filter: `"individual"` \| `"organization"` \| `"system"` |
| `search` | `string` | Search by holder ID |

### Transactions

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/transactions` | List transactions with filtering |
| `POST` | `/transactions/credit` | Credit an account |
| `POST` | `/transactions/debit` | Debit an account |
| `POST` | `/transactions/transfer` | Transfer between accounts |
| `POST` | `/transactions/multi-transfer` | Multi-destination transfer |
| `POST` | `/transactions/refund` | Refund a transaction (full or partial) |
| `POST` | `/transactions/correct` | Correct a posted transaction (reversal + new entry) |
| `POST` | `/transactions/adjust` | Create an adjustment entry (accrual, depreciation, etc.) |
| `POST` | `/transactions/journal` | Create a free-form journal entry |
| `GET` | `/transactions/:id` | Get transaction by ID |

**List transactions query parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `holderId` | `string` | Required — whose transactions to list |
| `page` | `number` | Page number |
| `perPage` | `number` | Items per page |
| `status` | `string` | Filter: `"posted"` \| `"reversed"` \| etc. |
| `type` | `string` | Filter: `"credit"` \| `"debit"` \| `"transfer"` |
| `category` | `string` | Filter by category |
| `dateFrom` | `string` | Filter: created after (ISO date) |
| `dateTo` | `string` | Filter: created before (ISO date) |
| `amountMin` | `number` | Filter: minimum amount |
| `amountMax` | `number` | Filter: maximum amount |

### Holds

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/holds` | List all holds with filtering |
| `GET` | `/holds/active` | List active (inflight) holds only |
| `POST` | `/holds` | Create a hold |
| `POST` | `/holds/multi-destination` | Create a multi-destination hold |
| `POST` | `/holds/:holdId/commit` | Commit a hold (optional partial amount) |
| `POST` | `/holds/:holdId/void` | Void a hold |
| `GET` | `/holds/:id` | Get hold by ID |

**List holds query parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `holderId` | `string` | Required — whose holds to list |
| `page` | `number` | Page number |
| `perPage` | `number` | Items per page |
| `status` | `string` | Filter: `"inflight"` \| `"posted"` \| `"voided"` \| `"expired"` |
| `category` | `string` | Filter by category |

### Limits

| Method | Path | Description |
|--------|------|-------------|
| `POST` | `/limits` | Set a velocity limit |
| `GET` | `/limits/:holderId` | Get all limits for a holder |
| `DELETE` | `/limits/:holderId` | Remove a limit |
| `GET` | `/limits/:holderId/usage` | Get current usage (daily/monthly breakdown) |

**Set limit request body:**

```json
{
  "holderId": "user_123",
  "limitType": "daily",
  "maxAmount": 50000,
  "category": "payments",
  "enabled": true
}
```

**Get usage query parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `txnType` | `string` | Filter: `"credit"` \| `"debit"` \| `"hold"` |
| `category` | `string` | Filter by category |

### Events

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/events/:aggregateType/:aggregateId` | Get all events for an aggregate |
| `GET` | `/events/correlation/:correlationId` | Get events by correlation ID |
| `POST` | `/events/verify` | Verify hash chain integrity |

**Verify request body:**

```json
{
  "aggregateType": "account",
  "aggregateId": "uuid-here"
}
```

### Plugin Endpoints

Plugins can register additional endpoints via their `endpoints` array. These are routed through the same handler automatically.

**Admin plugin** (when enabled):

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/admin/accounts` | List all accounts (admin view) |
| `GET` | `/admin/accounts/:holderId` | Account detail with balance, recent txns, active holds |
| `POST` | `/admin/accounts/:holderId/freeze` | Freeze account |
| `POST` | `/admin/accounts/:holderId/unfreeze` | Unfreeze account |
| `POST` | `/admin/accounts/:holderId/close` | Close account |
| `GET` | `/admin/transactions` | List all transactions (cross-account) |
| `GET` | `/admin/transactions/:id` | Transaction detail with entry records |
| `POST` | `/admin/transactions/:id/refund` | Refund a transaction |
| `GET` | `/admin/holds` | List all holds |
| `GET` | `/admin/reconciliation/status` | Get reconciliation status |
| `POST` | `/admin/reconciliation/run` | Trigger reconciliation |
| `GET` | `/admin/system-accounts` | List system accounts with balances |
| `GET` | `/admin/stats` | Dashboard stats (accounts, transactions, holds) |

**OpenAPI plugin** (when enabled):

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/openapi.json` | OpenAPI 3.1 specification |

**Observability plugin** (when enabled):

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/metrics` | Prometheus-compatible metrics (text format) |

**Statements plugin** (when enabled):

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/statements/:holderId` | Full account statement (JSON, CSV, or PDF) |
| `GET` | `/statements/:holderId/summary` | Statement summary only (no line items) |

**FX Engine plugin** (when enabled):

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/fx/rate` | Get current exchange rate (`?from=USD&to=EUR`) |
| `POST` | `/fx/quote` | Create a rate quote |
| `POST` | `/fx/quote/:id/use` | Mark a quote as used and record gain/loss |
| `GET` | `/fx/gain-loss` | Query realized FX gain/loss entries (paginated) |

**Data Retention plugin** (when enabled):

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/retention/status` | Current retention status with per-table row counts |

## Security & Protection

### Rate Limiting

Summa includes built-in rate limiting with configurable presets:

```ts
import { createRateLimiter, standardRateLimit } from "summa/api";

const rateLimiter = createRateLimiter(standardRateLimit);

const handler = createSummaHono(summa, {
  rateLimiter,
  rateLimitKeyExtractor: (req) => req.headers?.["x-api-key"] ?? "anonymous",
});
```

#### Presets

| Preset | Max Requests | Window |
|--------|-------------|--------|
| `standardRateLimit` | 100 | 60 seconds |
| `strictRateLimit` | 20 | 60 seconds |
| `lenientRateLimit` | 500 | 60 seconds |
| `burstRateLimit` | 10 | 1 second |

#### Custom Configuration

```ts
const rateLimiter = createRateLimiter({
  window: 60,         // seconds
  max: 200,           // max requests
  storage: "memory",  // "memory" | "database" | "secondary"
});
```

Rate limit state can be stored in:
- **Memory** — in-process token bucket (default, no external dependency)
- **Database** — PostgreSQL sliding window (shared across instances)
- **Secondary** — Redis-compatible store with TTL (requires `secondaryStorage` config)

#### Response Headers

When rate limiting is enabled, every response includes:

| Header | Description |
|--------|-------------|
| `X-RateLimit-Limit` | Maximum requests allowed in window |
| `X-RateLimit-Remaining` | Remaining requests in current window |
| `X-RateLimit-Reset` | Unix timestamp when the window resets |
| `Retry-After` | Seconds to wait (only present when rate limited) |

### Security Headers

Every API response includes the following security headers by default:

| Header | Value | Purpose |
|--------|-------|---------|
| `X-Content-Type-Options` | `nosniff` | Prevents MIME-type sniffing |
| `X-Frame-Options` | `DENY` | Prevents clickjacking via iframes |
| `Referrer-Policy` | `strict-origin-when-cross-origin` | Limits referrer information leakage |
| `X-XSS-Protection` | `0` | Disables legacy browser XSS filter (modern best practice) |
| `Content-Security-Policy` | `default-src 'none'; frame-ancestors 'none'` | Restricts resource loading and framing |

These headers are applied automatically and cannot be disabled. If you need additional headers (e.g., `Strict-Transport-Security`), add them at your reverse proxy or via the `onResponse` hook:

```ts
const handler = createSummaHono(summa, {
  onResponse: (req, res) => {
    res.headers = {
      ...res.headers,
      "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
    };
    return res;
  },
});
```

### CSRF Protection

Enable origin checking for mutating requests:

```ts
const handler = createSummaHono(summa, {
  trustedOrigins: ["https://app.example.com", "https://admin.example.com"],
});
```

When `trustedOrigins` is set, POST/PUT/PATCH/DELETE requests must include a valid `Origin` header. Server-to-server calls without an `Origin` header are allowed through.

### Request Validation

All POST endpoints validate the request body at the handler level. Missing or invalid required fields return an `INVALID_ARGUMENT` error:

```json
{
  "error": {
    "code": "INVALID_ARGUMENT",
    "message": "Missing required field: holderId (expected string)"
  }
}
```

Validation checks that required fields are present and have the correct type (`string`, `number`, `object`). Optional fields (suffixed with `?` internally) are allowed to be absent.

Financial endpoints (credit, debit, transfer, multi-transfer, holds) additionally validate that `amount` is a **positive integer** — negative, zero, fractional, `Infinity`, and `NaN` values are rejected with `INVALID_ARGUMENT`.

## Examples

### Request/Response Format

All requests and responses use JSON. Amounts are always in the **smallest currency unit** (cents/paise).

### Create Account

```bash
curl -X POST http://localhost:3000/api/ledger/accounts \
  -H "Content-Type: application/json" \
  -d '{
    "holderId": "user_123",
    "holderType": "individual",
    "currency": "USD"
  }'
```

### Transfer

```bash
curl -X POST http://localhost:3000/api/ledger/transactions/transfer \
  -H "Content-Type: application/json" \
  -d '{
    "sourceHolderId": "user_123",
    "destinationHolderId": "merchant_1",
    "amount": 5000,
    "reference": "order-001"
  }'
```

### Set Velocity Limit

```bash
curl -X POST http://localhost:3000/api/ledger/limits \
  -H "Content-Type: application/json" \
  -d '{
    "holderId": "user_123",
    "limitType": "daily",
    "maxAmount": 100000
  }'
```

### List Transactions

```bash
curl "http://localhost:3000/api/ledger/transactions?holderId=user_123&status=posted&dateFrom=2026-01-01"
```

## Error Responses

All errors return a JSON body with `code` and `message`:

```json
{
  "error": {
    "code": "INSUFFICIENT_BALANCE",
    "message": "Insufficient balance: available 5000, requested 10000"
  }
}
```

See [Error Codes](/docs/error-codes) for the full list.

## Client SDK

For programmatic access from other services, use the type-safe client SDK:

```ts
import { createSummaClient } from "@summa/client";

const client = createSummaClient({
  baseURL: "http://ledger-service:3000/api/ledger",
});

const account = await client.accounts.create({
  holderId: "user_123",
  holderType: "individual",
  currency: "USD",
});
```

See [Client SDK](/docs/client-sdk) for full documentation.
