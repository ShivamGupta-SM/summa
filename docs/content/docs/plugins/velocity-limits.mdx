---
title: Velocity Limits
description: Enforce transaction rate and amount limits per account.
icon: Bolt
---

## Overview

The velocity limits plugin enforces configurable limits on transaction amounts, protecting against fraud, abuse, and regulatory non-compliance. Limits can be set per-transaction, daily, or monthly â€” with optional **category-based segmentation**.

## Setup

```ts
import { createSumma } from "@summa-ledger/summa";
import { velocityLimits } from "@summa-ledger/summa/plugins";

const summa = createSumma({
  database: adapter,
  currency: "USD",
  plugins: [velocityLimits()],
});
```

## Configuration

```ts
velocityLimits({
  cleanupRetentionDays: 90,  // Keep usage records for 90 days (default)
  autoEnforce: true,          // Automatically check limits on transactions (default)
})
```

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `cleanupRetentionDays` | `number` | `90` | Days to retain usage tracking records |
| `autoEnforce` | `boolean` | `true` | Automatically enforce limits via `beforeTransaction` hook |

## Setting Limits

```ts
// Daily limit
await summa.limits.set({
  holderId: "user_123",
  limitType: "daily",
  maxAmount: 10_000_00, // $10,000/day
});

// Monthly limit
await summa.limits.set({
  holderId: "user_123",
  limitType: "monthly",
  maxAmount: 50_000_00, // $50,000/month
});

// Per-transaction limit
await summa.limits.set({
  holderId: "user_123",
  limitType: "per_transaction",
  maxAmount: 5_000_00, // $5,000 max per transaction
});
```

## Limit Types

| Type | Description |
|------|-------------|
| `per_transaction` | Maximum amount per single transaction |
| `daily` | Maximum total amount per calendar day |
| `monthly` | Maximum total amount per calendar month |

## Category-Based Limits

Set different limits for different transaction categories:

```ts
// $1,000/day for marketplace purchases
await summa.limits.set({
  holderId: "user_123",
  limitType: "daily",
  maxAmount: 1_000_00,
  category: "marketplace",
});

// $5,000/day for peer-to-peer transfers
await summa.limits.set({
  holderId: "user_123",
  limitType: "daily",
  maxAmount: 5_000_00,
  category: "p2p",
});
```

When a transaction includes a `category`, only limits for that category are checked.

## Getting Limits

```ts
const limits = await summa.limits.get("user_123");
// Returns: AccountLimitInfo[]
```

## Checking Usage

```ts
const usage = await summa.limits.getUsage({
  holderId: "user_123",
  category: "marketplace",
});
console.log(usage.daily);   // Amount used today
console.log(usage.monthly); // Amount used this month
```

## Removing Limits

```ts
await summa.limits.remove({
  holderId: "user_123",
  limitType: "daily",
  category: "marketplace",
});
```

## How Enforcement Works

The plugin hooks into `beforeTransaction` to check limits before any balance mutation. If a limit would be exceeded, the transaction is rejected:

```ts
try {
  await summa.transactions.transfer({ ... });
} catch (error) {
  if (error.code === "LIMIT_EXCEEDED") {
    // Handle limit exceeded
  }
}
```
