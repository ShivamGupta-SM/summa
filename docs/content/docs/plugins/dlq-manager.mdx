---
title: DLQ Manager
description: Dead letter queue for failed event processing.
icon: ArchiveBoxXMark
---

## Overview

The DLQ (Dead Letter Queue) manager plugin captures events that fail processing after all retry attempts, allowing manual inspection, reprocessing, and resolution. Works together with the [outbox plugin](/docs/plugins/outbox).

## Setup

```ts
import { createSumma } from "@summa-ledger/summa";
import { dlqManager } from "@summa-ledger/summa/plugins";

const summa = createSumma({
  database: adapter,
  currency: "USD",
  plugins: [dlqManager()],
});
```

## Configuration

```ts
dlqManager({
  maxDisplayItems: 100,    // Max items returned by list() (default: 100)
  retryInterval: "30m",    // Auto-retry interval (default: "30m")
  maxAutoRetries: 3,       // Max automatic retry attempts (default: 3)
})
```

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `maxDisplayItems` | `number` | `100` | Maximum items returned by `list()` |
| `retryInterval` | `string` | `"30m"` | Background auto-retry worker interval |
| `maxAutoRetries` | `number` | `3` | Maximum automatic retry attempts |

## Inspecting Failed Events

### `getDlqStats`

Returns aggregate statistics about the dead letter queue:

```ts
import { getDlqStats } from "@summa-ledger/summa/plugins";

const stats = await getDlqStats(summa.$context);
console.log(stats.totalUnresolved);   // Events awaiting resolution
console.log(stats.totalResolved);     // Events already resolved
console.log(stats.byTopic);           // { "transaction.posted": 3, ... }
console.log(stats.oldestUnresolved);  // ISO timestamp or null
```

### `listUnresolvedEvents`

Returns a paginated list of unresolved failed events:

```ts
import { listUnresolvedEvents } from "@summa-ledger/summa/plugins";

const result = await listUnresolvedEvents(summa.$context, {
  page: 1,        // Page number (default: 1)
  perPage: 20,    // Items per page (default: 20)
  topic: "transaction.posted",  // Optional topic filter
});

for (const event of result.data) {
  console.log(event.id);            // DLQ entry ID
  console.log(event.topic);         // Event topic
  console.log(event.error_message); // Why it failed
  console.log(event.retry_count);   // How many times it's been retried
  console.log(event.created_at);    // When it first failed
}

console.log(result.total);    // Total matching events
console.log(result.hasMore);  // More pages available
```

## Reprocessing

### `retryEvent`

Requeues a failed event into the outbox for another delivery attempt. Increments the `retry_count`.

```ts
import { retryEvent } from "@summa-ledger/summa/plugins";

await retryEvent(summa.$context, "evt_failed_123");
```

Throws `NOT_FOUND` if the event doesn't exist or is already resolved.

## Resolving Events

### `resolveEvent`

Marks a failed event as resolved â€” it won't be retried again:

```ts
import { resolveEvent } from "@summa-ledger/summa/plugins";

await resolveEvent(summa.$context, {
  eventId: "evt_failed_123",
  resolvedBy: "admin@example.com",
});
```

Throws `NOT_FOUND` if the event doesn't exist or is already resolved.

## Type Inference

```ts
import type { FailedEvent, DlqStats } from "@summa-ledger/summa/plugins";

type Failed = typeof summa.$Infer.FailedEvent;
type Stats = typeof summa.$Infer.DlqStats;
// DlqStats: { totalUnresolved, totalResolved, byTopic, oldestUnresolved }
```
