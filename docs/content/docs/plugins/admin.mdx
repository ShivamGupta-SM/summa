---
title: Admin
description: Elevated management endpoints with dashboard stats, cross-account queries, and reconciliation controls.
icon: ShieldCheck
---

## Overview

The admin plugin adds **13 HTTP endpoints** for account management, cross-account transaction listing, reconciliation controls, system account inspection, and dashboard statistics. These endpoints are designed for internal admin dashboards and back-office tooling.

## Setup

```ts
import { admin } from "@summa-ledger/summa/plugins";

const summa = createSumma({
  database: adapter,
  plugins: [admin()],
});
```

## Configuration

```ts
admin({
  basePath: "/admin",  // Default — prefix for all admin routes
  authorize: async (req) => {
    const key = req.headers?.["x-admin-key"];
    return key === process.env.ADMIN_SECRET;
  },
})
```

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `basePath` | `string` | `"/admin"` | URL prefix for all admin endpoints |
| `authorize` | `(req) => boolean \| Promise<boolean>` | — | Authorization check for every admin request. Return `false` to reject with 403. |

### Authorization

<Callout type="warn">
If `authorize` is not provided, a console warning is emitted at startup and **all admin endpoints are publicly accessible**. Always provide an `authorize` callback in production.
</Callout>

The `authorize` callback runs before every admin endpoint handler. If it returns `false`, the request is rejected with HTTP 403:

```json
{ "error": { "code": "FORBIDDEN", "message": "Admin access denied" } }
```

<Tabs items={["API key", "JWT token"]}>
<Tab value="API key">

```ts
admin({
  authorize: (req) => req.headers?.["x-admin-key"] === process.env.ADMIN_KEY,
})
```

</Tab>
<Tab value="JWT token">

```ts
admin({
  authorize: async (req) => {
    const token = req.headers?.["authorization"]?.replace("Bearer ", "");
    if (!token) return false;
    const payload = await verifyJwt(token);
    return payload.role === "admin";
  },
})
```

</Tab>
</Tabs>

## Endpoints

### Account Management

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/admin/accounts` | List all accounts with pagination and filtering |
| `GET` | `/admin/accounts/:holderId` | Full account detail: balance, recent transactions, active holds |
| `POST` | `/admin/accounts/:holderId/freeze` | Freeze an account |
| `POST` | `/admin/accounts/:holderId/unfreeze` | Unfreeze an account |
| `POST` | `/admin/accounts/:holderId/close` | Close an account |

The `GET /admin/accounts/:holderId` endpoint returns a combined view:

```json
{
  "account": { ... },
  "balance": { ... },
  "recentTransactions": [ ... ],
  "activeHolds": [ ... ]
}
```

### Transaction Management

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/admin/transactions` | List all transactions across all accounts |
| `GET` | `/admin/transactions/:id` | Transaction detail with individual entry records |
| `POST` | `/admin/transactions/:id/refund` | Refund a transaction |

The `GET /admin/transactions` endpoint supports cross-account queries (no `holderId` required):

| Query Param | Type | Description |
|-------------|------|-------------|
| `page` | `number` | Page number (clamped to minimum 1, floats are floored) |
| `perPage` | `number` | Items per page (clamped to 1–200, default 50) |
| `status` | `string` | Filter by status. Must be one of: `"pending"`, `"inflight"`, `"posted"`, `"expired"`, `"voided"`, `"reversed"` |
| `type` | `string` | Filter by type. Must be one of: `"credit"`, `"debit"`, `"transfer"` |
| `dateFrom` | `string` | Filter: created after (ISO date) |
| `dateTo` | `string` | Filter: created before (ISO date) |

Invalid `status` or `type` values return a `400 VALIDATION_ERROR`.

### Hold Management

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/admin/holds` | List all holds across all accounts |

**Query parameters:**

| Query Param | Type | Description |
|-------------|------|-------------|
| `page` | `number` | Page number (clamped to minimum 1, floats are floored) |
| `perPage` | `number` | Items per page (clamped to 1–200, default 50) |
| `status` | `string` | Filter by status. Must be one of: `"inflight"`, `"posted"`, `"voided"`, `"expired"` |

Invalid `status` values return a `400 VALIDATION_ERROR`.

### Reconciliation

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/admin/reconciliation/status` | Get latest reconciliation results |
| `POST` | `/admin/reconciliation/run` | Trigger a reconciliation run |

### System Accounts

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/admin/system-accounts` | List all system accounts with balances |

Returns system accounts joined with their balance data:

```json
{
  "systemAccounts": [
    {
      "id": "...",
      "identifier": "@World",
      "name": "World Account",
      "currency": "USD",
      "balance": -50000,
      "available_balance": -50000,
      "status": "active"
    }
  ]
}
```

### Dashboard Stats

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/admin/stats` | Aggregated dashboard statistics |

Returns:

```json
{
  "accounts": {
    "total": 150,
    "active": 140,
    "frozen": 5,
    "closed": 5
  },
  "transactions": {
    "total": 10234,
    "totalVolume": 5000000,
    "todayCount": 42,
    "todayVolume": 150000
  },
  "holds": {
    "activeCount": 12,
    "activeAmount": 50000
  }
}
```

## Notes

- If `authorize` is not set, a **console warning** is emitted at startup and admin endpoints are unauthenticated. Always set `authorize` in production.
- All query parameters (`status`, `type`) are validated against known enum values. Invalid values are rejected with `400 VALIDATION_ERROR`.
- Pagination parameters (`page`, `perPage`) are clamped to safe ranges — negative, fractional, or non-numeric values are handled gracefully.
- All admin endpoints route through the same plugin endpoint system, so they benefit from rate limiting and CSRF protection if configured.
- The `basePath` can be customized to avoid conflicts (e.g., `"/internal/admin"`).
