---
title: Audit Log
description: Immutable audit trail for all ledger operations.
icon: ClipboardDocumentList
---

## Overview

The audit log plugin records every account creation, transaction, hold, and administrative action into a dedicated `audit_log` table. Every mutation is tracked with who did it, what happened, and when.

## Setup

```ts
import { createSumma } from "summa";
import { auditLog } from "summa/plugins";

const summa = createSumma({
  database: adapter,
  currency: "USD",
  plugins: [auditLog()],
});
```

## Configuration

```ts
auditLog({
  operations: ["transaction.credit", "account.freeze"],  // Filter specific operations
  retentionDays: 365,       // How long to keep audit entries (default: 365)
  cleanupInterval: "1d",    // How often to purge old entries (default: "1d")
})
```

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `operations` | `string[]` | All operations | Filter to specific operation types |
| `retentionDays` | `number` | `365` | Days to retain audit log entries |
| `cleanupInterval` | `string` | `"1d"` | Background cleanup worker interval |

## How It Works

The plugin hooks into `afterTransaction`, `afterAccountCreate`, and `afterHoldCommit` lifecycle events. Every mutation is recorded with:

- **operation** — what happened (e.g., `transaction.credit`, `account.freeze`, `hold.commit`)
- **params** — the operation parameters
- **actor** — who performed the action (if available)
- **timestamp** — when the action occurred

## Querying Audit Logs

Use the standalone `queryAuditLog` function to search the audit trail:

```ts
import { queryAuditLog } from "summa/plugins";

const logs = await queryAuditLog(summa.$context, {
  operation: "transaction.credit",  // Filter by operation type
  actor: "admin@example.com",       // Filter by actor
  since: new Date("2025-01-01"),    // Start date
  until: new Date("2025-02-01"),    // End date
  limit: 50,                        // Default: 50
  offset: 0,                        // Pagination offset
});

for (const entry of logs) {
  console.log(entry.id);         // Unique entry ID
  console.log(entry.operation);  // "transaction.credit"
  console.log(entry.params);     // { holderId: "user_123", amount: 10000, ... }
  console.log(entry.actor);      // "admin@example.com" or null
  console.log(entry.timestamp);  // "2025-01-15T10:30:00Z"
}
```

### Query Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `operation` | `string` | — | Filter by operation type |
| `actor` | `string` | — | Filter by actor identifier |
| `since` | `Date` | — | Entries after this date |
| `until` | `Date` | — | Entries before this date |
| `limit` | `number` | `50` | Max entries to return |
| `offset` | `number` | `0` | Pagination offset |

## Type Inference

```ts
import type { AuditLogEntry } from "summa/plugins";

type AuditEntry = typeof summa.$Infer.AuditLogEntry;
// { id, operation, params, actor, timestamp }
```

## Tracked Operations

| Operation | Trigger |
|-----------|---------|
| `account.create` | Account created |
| `account.freeze` | Account frozen |
| `account.unfreeze` | Account unfrozen |
| `account.close` | Account closed |
| `transaction.credit` | Funds credited |
| `transaction.debit` | Funds debited |
| `transaction.transfer` | Funds transferred |
| `transaction.refund` | Transaction refunded |
| `hold.create` | Hold created |
| `hold.commit` | Hold committed |
| `hold.void` | Hold voided |
